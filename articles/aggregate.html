<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rapidcycler">
<title>aggregate • rapidcycler</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="aggregate">
<meta property="og:description" content="rapidcycler">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rapidcycler</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/aggregate.html">aggregate</a>
    <a class="dropdown-item" href="../articles/validate.html">validate</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>aggregate</h1>
            
      
      
      <div class="d-none name"><code>aggregate.Rmd</code></div>
    </div>

    
    
<p>To participate in RCA, <strong>sites are only required to interact
with the aggregation part of the package</strong>. The other
functionalities will be used by GVDN to perform the analyses and report
results, however will be provided to sites to make use of if they wish
to (expected in future version).</p>
<p>The primary function for aggregation is
<code><a href="../reference/aggregate_data.html">aggregate_data()</a></code>. You can view the full documentation using
<code><a href="../reference/aggregate_data.html">?aggregate_data</a></code> or <code><a href="../reference/aggregate_data.html">help("aggregate_data")</a></code>. A
few key things to note:</p>
<ul>
<li><p>Requires input data in the format described in the data
dictionary and output templates, also summarised in a later
section.</p></li>
<li><p>If the <code>vaccination_data</code> input is set to
<code>NULL</code>, the function will perform historical data
aggregation.</p></li>
<li><p>The input datasets are saved and removed from the global
environment during aggregation, but restored afterwards by default (see
<code>restore_input_data</code> parameter). They can also be restored
manually using the <code><a href="../reference/recombine_input_data.html">recombine_input_data()</a></code> function. Once
aggregation is complete, the saved versions of the input datasets are
deleted. If you would like to store the input datasets that were used,
please do so manually whilst they are still in your global
environment.</p></li>
<li><p>Validation of the input datasets is run automatically before
aggregation is started. If any issues are found, aggregation will be
aborted and the issues printed in the console. These issues will need to
be fixed before aggregation can be completed. Validation can also be run
separately - see Advanced usage section at the end of this
document.</p></li>
<li><p>There is no output from the function, however it will create a
new folder with the name format
“RCA_[STUDY_CODENAME]_[SITE_CODE]_[CYCLE_START]-[CYCLE_END]”, at the
location specified by <code>working_directory</code>, and save the
aggregated tables within it. Once complete, this folder should be zipped
and sent to GVDN.</p></li>
<li><p>Requires an ‘options.txt’ file to run - this can be found on the
extranet (<a href="https://uoa.sharepoint.com/:f:/r/sites/globalvaccinedatanetwork/Shared%20Documents/GCoVS%20Project/2.%20Rapid%20Cycle%20Analyses/RCA%20II%20(2024)?csf=1&amp;web=1&amp;e=eV1u5Y" class="external-link">RCA
II (2024)</a>) and should be downloaded and saved in an appropriate
location (specified by <code>options_file_location</code>). This same
file should be used for the duration of the study (one options file per
study module).</p></li>
</ul>
<div class="section level3">
<h3 id="set-up-for-examples">Set up for examples<a class="anchor" aria-label="anchor" href="#set-up-for-examples"></a>
</h3>
<p>Load the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://atkinsbd.github.io/rapidcycler" class="external-link">rapidcycler</a></span><span class="op">)</span></span></code></pre></div>
<p>If you would like to use synthetic data to run the examples, you can
create and save that in the current working directory with the code
below:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generate_synthetic_data.html">generate_synthetic_data</a></span><span class="op">(</span>pop_size <span class="op">=</span> <span class="fl">1000000</span><span class="op">)</span></span></code></pre></div>
<p>Or, if you already have some data saved in the current working
directory, load it as so:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">patient_data</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"patient_data.csv"</span><span class="op">)</span></span>
<span><span class="va">vaccination_data</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"vaccination_data.csv"</span><span class="op">)</span></span>
<span><span class="va">outcome_data</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"outcome_data.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-default-usage">Example: Default usage<a class="anchor" aria-label="anchor" href="#example-default-usage"></a>
</h3>
<p>There are 7 required inputs for the function, and several optional
inputs that will revert to a default if not specified.</p>
<p>The code below will create a new folder in your current working
directory, given by <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code>. There must also be an
‘options.txt’ file saved in this location.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assuming patient_data, vaccination_data, and outcome_data are data.table objects already loaded into the global environment</span></span>
<span><span class="fu"><a href="../reference/aggregate_data.html">aggregate_data</a></span><span class="op">(</span><span class="va">patient_data</span>, <span class="va">vaccination_data</span>, <span class="va">outcome_data</span>,</span>
<span>               cycle_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>,</span>
<span>               cycle_end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-31"</span><span class="op">)</span>,</span>
<span>               site_code <span class="op">=</span> <span class="st">"TEST_SITE"</span>,</span>
<span>               participation_level <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-using-different-locations">Example: Using different locations<a class="anchor" aria-label="anchor" href="#example-using-different-locations"></a>
</h3>
<p>There are two important file locations within the function:</p>
<ul>
<li><p><code>options_file_location</code>: this is where the
‘options.txt’ file is stored (in local memory)</p></li>
<li><p><code>working_directory</code>: this is where a new folder will
be created, within which aggregated tables are saved</p></li>
</ul>
<p>Both these inputs will default to the current working directory,
given by <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code>, if not specified. To use a different
location, you can either change your current working directory using
<code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd()</a></code> (both locations will be the same), or use these
inputs to specify different locations (they do not need to match, but in
our recommended folder structure they do).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assuming patient_data, vaccination_data, and outcome_data are data.table objects already loaded into the global environment</span></span>
<span><span class="fu"><a href="../reference/aggregate_data.html">aggregate_data</a></span><span class="op">(</span><span class="va">patient_data</span>, <span class="va">vaccination_data</span>, <span class="va">outcome_data</span>,</span>
<span>               cycle_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>,</span>
<span>               cycle_end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-31"</span><span class="op">)</span>,</span>
<span>               site_code <span class="op">=</span> <span class="st">"TEST_SITE"</span>,</span>
<span>               participation_level <span class="op">=</span> <span class="fl">3</span>,</span>
<span>               options_file_location <span class="op">=</span> <span class="st">"~/Documents/RCA_COVID/"</span>,</span>
<span>               working_directory <span class="op">=</span> <span class="st">"~/Documents/RCA_COVID/"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-memory-considerations">Example: Memory considerations<a class="anchor" aria-label="anchor" href="#example-memory-considerations"></a>
</h3>
<div class="section level4">
<h4 id="insufficient-ram">Insufficient RAM<a class="anchor" aria-label="anchor" href="#insufficient-ram"></a>
</h4>
<p>If you find that you are running out of RAM during execution of the
<code><a href="../reference/aggregate_data.html">aggregate_data()</a></code> function, or execution is very slow, you
can restrict the amount of data that is aggregated at one time using the
<code>split_size</code> input. The function splits the input data into
portions of size <code>split_size</code> according to <code>PID</code>,
stores the split datasets in a subfolder called ‘data’, aggregates one
split at a time, and then recombines and performs the final aggregation
once all splits are complete. The default is 500,000, and should be
lowered if memory is an issue. If you have large amounts of RAM,
increasing the split size may also speed up aggregation. <strong>NOTE:
you should still input the whole datasets - the function will handle the
splitting itself</strong>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assuming patient_data, vaccination_data, and outcome_data are data.table objects already loaded into the global environment</span></span>
<span><span class="fu"><a href="../reference/aggregate_data.html">aggregate_data</a></span><span class="op">(</span><span class="va">patient_data</span>, <span class="va">vaccination_data</span>, <span class="va">outcome_data</span>,</span>
<span>               cycle_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>,</span>
<span>               cycle_end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-31"</span><span class="op">)</span>,</span>
<span>               site_code <span class="op">=</span> <span class="st">"TEST_SITE"</span>,</span>
<span>               participation_level <span class="op">=</span> <span class="fl">3</span>, </span>
<span>               split_size <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="input-datasets-too-large">Input datasets too large<a class="anchor" aria-label="anchor" href="#input-datasets-too-large"></a>
</h4>
<p><strong>NOTE: only use this method if your input datasets are so
large that it is not possible to load them into R in one go</strong>. If
so, you can divide the data into chunks before aggregating. If you do
so, you must specify <code>input_data_in_chunks = TRUE</code>. The data
should be divided into chunks by <code>PID</code>, so that all the
records associated with a person are included in the same chunk. The
temporary results from each chunk will be stored until the last chunk is
aggregated (specified using <code>final_chunk = TRUE</code>), after
which the temporary results will be combined and the final aggregation
performed.</p>
<p>In this case, you will need to call the <code><a href="../reference/aggregate_data.html">aggregate_data()</a></code>
function multiple times. Each time, you should pass only a single chunk
of each dataset, therefore, requires loading a new chunk of input data
(either from a saved file or directly from the database) before each
function call.</p>
<p>The example below assumes that the input datasets are split into 2
chunks, and there exists code to retrieve these chunks from a saved file
or directly from the database.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">patient_data_chunk1</span> <span class="op">&lt;-</span> <span class="fu">load_patient_data_chunk1</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">vaccination_data_chunk1</span> <span class="op">&lt;-</span> <span class="va">load_vaccination_data_chunk1</span></span>
<span><span class="va">outcome_data_chunk1</span> <span class="op">&lt;-</span> <span class="va">load_outcome_data_chunk1</span></span>
<span></span>
<span><span class="fu"><a href="../reference/aggregate_data.html">aggregate_data</a></span><span class="op">(</span><span class="va">patient_data_chunk1</span>, <span class="va">vaccination_data_chunk1</span>, <span class="va">outcome_data_chunk1</span>,</span>
<span>               cycle_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>,</span>
<span>               cycle_end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-31"</span><span class="op">)</span>,</span>
<span>               site_code <span class="op">=</span> <span class="st">"TEST_SITE"</span>,</span>
<span>               participation_level <span class="op">=</span> <span class="fl">3</span>, </span>
<span>               input_data_in_chunks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               final_chunk <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># FALSE until final chunk</span></span>
<span></span>
<span><span class="co"># Remove data from memory (can also do this automatically by setting 'restore_input_data = FALSE' in function call)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="st">"patient_data_chunk1"</span>, <span class="st">"vaccination_data_chunk1"</span>, <span class="st">"outcome_data_chunk1"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">patient_data_chunk2</span> <span class="op">&lt;-</span> <span class="fu">load_patient_data_chunk2</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">vaccination_data_chunk2</span> <span class="op">&lt;-</span> <span class="va">load_vaccination_data_chunk2</span></span>
<span><span class="va">outcome_data_chunk2</span> <span class="op">&lt;-</span> <span class="va">load_outcome_data_chunk2</span></span>
<span></span>
<span><span class="fu"><a href="../reference/aggregate_data.html">aggregate_data</a></span><span class="op">(</span><span class="va">patient_data_chunk2</span>, <span class="va">vaccination_data_chunk2</span>, <span class="va">outcome_data_chunk2</span>,</span>
<span>               cycle_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>,</span>
<span>               cycle_end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-31"</span><span class="op">)</span>,</span>
<span>               site_code <span class="op">=</span> <span class="st">"TEST_SITE"</span>,</span>
<span>               participation_level <span class="op">=</span> <span class="fl">3</span>, </span>
<span>               input_data_in_chunks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               final_chunk <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># TRUE to trigger final aggregation</span></span>
<span></span>
<span><span class="co"># Remove data from memory (can also do this automatically by setting 'restore_input_data = FALSE' in function call)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="st">"patient_data_chunk2"</span>, <span class="st">"vaccination_data_chunk2"</span>, <span class="st">"outcome_data_chunk2"</span><span class="op">)</span></span></code></pre></div>
<p><strong>IMPORTANT - do not combine fully aggregated tables together,
as this will not produce correctly aggregated tables. Dealing with the
input data in chunks must be performed in the way described
above</strong></p>
</div>
</div>
<div class="section level3">
<h3 id="example-stopping-and-restarting-aggregation">Example: Stopping and restarting aggregation<a class="anchor" aria-label="anchor" href="#example-stopping-and-restarting-aggregation"></a>
</h3>
<p>It is possible to stop the aggregation and restart at a later time.
You can stop aggregation by manually interrupting execution, or by using
the <code>stop_after_n_splits</code> input. Either way, aggregation can
be resumed from where it was stopped. Note that, if you stop aggregation
by manually interrupting execution, the input datasets will not be
restored to the global environment afterwards. However, they are saved
in the ‘data’ subfolder (in split format) ready for resumption, and can
be restored to the global environment using the
<code><a href="../reference/recombine_input_data.html">recombine_input_data()</a></code> function.</p>
<p>The example below will stop aggregation after 2 splits of the input
datasets have been aggregated (note, this will aggregate those splits
across all time periods and study designs).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assuming patient_data, vaccination_data, and outcome_data are data.table objects already loaded into the global environment</span></span>
<span><span class="fu"><a href="../reference/aggregate_data.html">aggregate_data</a></span><span class="op">(</span><span class="va">patient_data</span>, <span class="va">vaccination_data</span>, <span class="va">outcome_data</span>,</span>
<span>               cycle_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>,</span>
<span>               cycle_end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-31"</span><span class="op">)</span>,</span>
<span>               site_code <span class="op">=</span> <span class="st">"TEST_SITE"</span>,</span>
<span>               participation_level <span class="op">=</span> <span class="fl">3</span>, </span>
<span>               stop_after_n_splits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The simplest way to resume aggregation is by using the
<code><a href="../reference/resume_cycle_aggregation.html">resume_cycle_aggregation()</a></code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/resume_cycle_aggregation.html">resume_cycle_aggregation</a></span><span class="op">(</span>folder_name <span class="op">=</span> <span class="st">"RCA_COVID_TEST_SITE_20220101-20220131"</span>, </span>
<span>                         working_directory <span class="op">=</span> <span class="st">"~/Documents/RCA_COVID/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># NOTE: also optional arguments stop_after_n_splits, input_data_in_chunks, and final_chunk, that behave in the same way as previously described</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="input-datasets">Input datasets<a class="anchor" aria-label="anchor" href="#input-datasets"></a>
</h3>
<p>A full data dictionary can be found here: <a href="https://uoa.sharepoint.com/:f:/r/sites/globalvaccinedatanetwork/Shared%20Documents/GCoVS%20Project/2.%20Rapid%20Cycle%20Analyses/RCA%20II%20(2024)?csf=1&amp;web=1&amp;e=eV1u5Y" class="external-link">RCA
II (2024)</a></p>
<p>The input datasets should have the following structures:</p>
<p><strong><em>patient_data</em></strong></p>
<table class="table">
<colgroup>
<col width="26%">
<col width="38%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th align="left">Column name</th>
<th align="left">Column type</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>PID</strong></td>
<td align="left">character</td>
<td align="left">Individual or person-level identifier, often
pseudo-anonymised</td>
</tr>
<tr class="even">
<td align="left"><strong>DOB</strong></td>
<td align="left">8 digit integer</td>
<td align="left">Date of birth of patient</td>
</tr>
<tr class="odd">
<td align="left"><strong>SEX</strong></td>
<td align="left">character</td>
<td align="left">The biological sex at birth of the person</td>
</tr>
<tr class="even">
<td align="left"><strong>ENROL_DATE</strong></td>
<td align="left">8 digit integer</td>
<td align="left">Date the patient entered the cohort from which they are
eligible for inclusion in the study (independent of study dates). If
eligible from birth, can be set to NA and will default to DOB</td>
</tr>
<tr class="odd">
<td align="left"><strong>CENSOR_DATE</strong></td>
<td align="left">8 digit integer</td>
<td align="left">Date the patient left the cohort from which they are no
longer eligible for inclusion in the study (independent of study
dates)</td>
</tr>
<tr class="even">
<td align="left"><strong>CENSOR_TYPE</strong></td>
<td align="left">character</td>
<td align="left">Type of censoring (missing, dead, travelled, or
emigrated)</td>
</tr>
</tbody>
</table>
<p><strong><em>vaccination_data</em></strong></p>
<table class="table">
<colgroup>
<col width="26%">
<col width="38%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th align="left">Column name</th>
<th align="left">Column type</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>PID</strong></td>
<td align="left">character</td>
<td align="left">Individual or person-level identifier, often
pseudo-anonymised</td>
</tr>
<tr class="even">
<td align="left"><strong>V_DATE</strong></td>
<td align="left">8 digit integer</td>
<td align="left">Date of vaccination</td>
</tr>
<tr class="odd">
<td align="left"><strong>V_BRAND</strong></td>
<td align="left">character</td>
<td align="left">Code specifying the brand of vaccine given</td>
</tr>
</tbody>
</table>
<p><strong><em>outcome_data</em></strong></p>
<table class="table">
<colgroup>
<col width="26%">
<col width="38%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th align="left">Column name</th>
<th align="left">Column type</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong>PID</strong></td>
<td align="left">character</td>
<td align="left">Individual or person-level identifier, often
pseudo-anonymised</td>
</tr>
<tr class="even">
<td align="left"><strong>AESI</strong></td>
<td align="left">character</td>
<td align="left">Short name of AESI outcome (Tier 2 unless otherwise
specified)</td>
</tr>
<tr class="odd">
<td align="left"><strong>EVENT_DATE</strong></td>
<td align="left">8 digit integer</td>
<td align="left">Diagnosis date through healthcare providers</td>
</tr>
<tr class="even">
<td align="left"><strong>ENCOUNTER_TYPE</strong></td>
<td align="left">numeric</td>
<td align="left">Source of the diagnosis information from healthcare
setting (code from 1-4)</td>
</tr>
</tbody>
</table>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Benjamin Atkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
